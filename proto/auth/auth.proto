syntax = "proto3";

package auth;

option go_package = "github.com/project-mikan/umi.mikan/backend/infrastructure/grpc";

service AuthService {
  // 新規登録設定の取得
  rpc GetRegistrationConfig(GetRegistrationConfigRequest) returns (GetRegistrationConfigResponse);

  // 新規登録
  rpc RegisterByPassword(RegisterByPasswordRequest) returns (AuthResponse);

  // ログイン
  rpc LoginByPassword(LoginByPasswordRequest) returns (AuthResponse);

  // AccessTokenの更新
  rpc RefreshAccessToken(RefreshAccessTokenRequest) returns (AuthResponse);
}

// 新規登録設定取得用のリクエスト
message GetRegistrationConfigRequest {
  // 空のリクエスト
}

// 新規登録設定取得用のレスポンス
message GetRegistrationConfigResponse {
  bool register_key_required = 1; // 登録キーが必要かどうか
}

// アクセストークン更新用のリクエスト
message RefreshAccessTokenRequest {
  string refresh_token = 1;
}

// パスワード新規登録用のリクエスト
message RegisterByPasswordRequest {
  string email = 1;
  string password = 2;
  string name = 3;
  string register_key = 4; // 新規登録キー（REGISTER_KEYが設定されている場合に必須）
}

// パスワードログイン用のリクエスト
message LoginByPasswordRequest {
  string email = 1;
  string password = 2;
}

// レスポンスはログイン方法に関わらず共通
message AuthResponse {
  string access_token = 1;
  string token_type = 2;
  int32 expires_in = 3; // 秒単位
  string refresh_token = 4;
}

